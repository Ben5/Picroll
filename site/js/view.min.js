$(document).ready(function(){function k(a,b){for(var c in b)$("#allThumbnailsContainer").find('img[data-imageid="'+b[c]+'"]').parents("div.thumbnailContainer").remove();c="Pictures Deleted Successfully!";1>=b.length&&(c="Picture Deleted Successfully!");l("success",c,$("#pictureNotificationArea").empty());g()}function m(a){a=a.images;$("#allThumbnailsContainer").empty();$.each(a,function(a,c){var d="/picroll/images/uploads/"+c+".jpeg",e="/picroll/images/uploads/"+c+"-thumb.jpeg",f=$("#thumbnailTemplate").find("div.thumbnailContainer").clone();
f.find("img").attr("data-imageid",a).attr("data-fullimgsrc",d).attr("src",e);$("#allThumbnailsContainer").append(f)});g()}function h(a){a.siblings("div.overlay").find("span").each(function(){$(this).toggle()})}function l(a,b,c){switch(a){case "success":a="alert-success";break;case "warning":a="alert-warning";break;case "error":case "danger":a="alert-danger";break;default:a="alert-info"}var d=$("#notificationTemplate").clone();d.addClass(a).text(b).removeAttr("id").hide();c.append(d);d.show(400,function(){var a=
setInterval(function(){d.hide(400,function(){clearInterval(a);d.remove()})},2E3)})}function g(){var a=$("#allThumbnailsContainer");a.find("div.clearfix").remove();var b=0,c=$("<div>").addClass("clearfix");a.find("div.thumbnailContainer").each(function(){b++;0===b%2&&c.clone().addClass("visible-sm").insertAfter($(this));0===b%4&&c.clone().addClass("visible-md").insertAfter($(this));0===b%6&&c.clone().addClass("visible-lg").insertAfter($(this))})}function e(a,b){var c=[];$("#"+a).find("span.glyphicon-check").filter(":visible").parents("div.overlay").siblings("img").each(function(){c.push($(this).data(b))});
return c}var f=0;$("#btnSelectPictures, #btnSelectAlbums").on("click",function(){var a=$("div.overlay");a.toggle(200);a.find("span.glyphicon-check").hide();a.find("span.glyphicon-unchecked").show();$(this).hasClass("btn-default")?$(this).addClass("btn-primary").removeClass("btn-default"):$(this).addClass("btn-default").removeClass("btn-primary")});$("#btnRemoveSelected").on("click",function(){var a=e("allThumbnailsContainer","imageid");0!==a.length&&bootbox.confirm("Do you want to remove "+a.length+
" picture"+(1<a.length?"s":"")+" from this Album?",function(b){b&&$.ajax({url:"/picroll/json/view/removeimagesfromalbum",data:{imageIds:a,albumId:f},type:"POST",dataType:"JSON",success:function(b){k(b,a)}})})});$("#btnDeleteSelected").on("click",function(){var a=e("allThumbnailsContainer","imageid");0!==a.length&&bootbox.confirm("Do you want to delete "+a.length+" picture"+(1<a.length?"s":"")+"?",function(b){b&&$.ajax({url:"/picroll/json/view/deleteimages",data:{imageIds:a},type:"POST",dataType:"JSON",
success:function(b){k(b,a)}})})});$("#btnDeleteSelectedAlbums").on("click",function(){var a=e("allAlbumsContainer","albumid");0!==a.length&&bootbox.confirm("Do you want to delete "+a.length+" album"+(1<a.length?"s":"")+"?<br>(You won't lose any pictures)",function(b){b&&(b={albumIds:a},console.log(b),$.ajax({url:"/picroll/json/view/deletealbums",data:b,type:"POST",dataType:"JSON",success:function(b){for(var d in a)$("#allAlbumsContainer").find('img[data-albumid="'+a[d]+'"]').parents("div.thumbnailContainer").remove();
b="Albums Deleted Successfully!";1>=a.length&&(b="Album Deleted Successfully!");l("success",b,$("#albumNotificationArea").empty());g()}}))})});$("#createNewAlbum").on("click",function(){var a=e("allThumbnailsContainer","imageid");0!==a.length&&bootbox.prompt("Name your new Album",function(b){0<b.length&&$.ajax({url:"/picroll/json/view/newalbum",data:{albumName:b,pictureIds:a},type:"POST",dataType:"JSON",success:function(a){a=$("<a>",{href:"#"}).addClass("existingAlbum");$("<li>").append(a).insertBefore($("#btnAddSelectedToAlbum").find("ul").find("li.divider"))}})})});
$("#btnAddSelectedToAlbum a.existingAlbum").on("click",function(){var a=e("allThumbnailsContainer","imageid");0!==a.length&&(a={albumId:$(this).data("albumid"),pictureIds:a},$.ajax({url:"/picroll/json/view/addtoalbum",data:a,type:"POST",dataType:"JSON",success:function(a){console.log(a)}}))});$("#btnViewAsSlideshow").on("click",function(){window.location.href="/picroll/html/slideshow/index?albumId="+f});$("#allThumbnailsContainer").on("click","img.thumbnail",function(){console.log("click");if($(this).siblings("div.overlay").is(":visible"))h($(this));
else{var a=$(this).data("fullimgsrc"),b=new Image;b.src=a;$("#fullscreenImageWrapper").fadeIn(400);$("#fullscreenImage").empty().append(b);$("div.modal-backdrop").fadeIn(400)}});$("#allAlbumsContainer").find("img.thumbnail").on("click",function(){if($(this).siblings("div.overlay").is(":visible"))h($(this));else{var a=$(this).data("albumid");f!=a&&(f=a,$.ajax({url:"/picroll/json/view/getalbumcontents",data:{albumId:a},type:"POST",dataType:"JSON",success:m}))}});$("div.overlay").on("click",function(){h($(this).siblings("img"))});
$("#fullscreenImage").on("click",function(){$("#fullscreenImageWrapper").fadeOut(400);$("div.modal-backdrop").fadeOut(400)});$("#fullscreenImage").on("click","img",function(a){a.stopPropagation()})});
